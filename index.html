<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App 3: UCP Global Dashboard | Systems Architect</title>
    <style>
        :root {
            --matrix-green: #00ff41; --void-black: #0d0208; --text-white: #f0fdf4;
            --danger-red: #ff3131; --gold: #ffd700; --panel-bg: #111827; --border: #22c55e;
            --incidental-orange: #f97316;
        }
        body { font-family: 'Courier New', monospace; background: var(--void-black); color: var(--text-white); margin: 0; padding: 20px; line-height: 1.5; }
        .app-container { max-width: 1250px; margin: 0 auto; border: 2px solid var(--border); border-radius: 12px; background: rgba(13, 2, 8, 0.98); position: relative; }
        header { padding: 1.5rem; border-bottom: 2px solid var(--border); text-align: center; background: #052e16; }
        
        .layout { display: grid; grid-template-columns: 1fr 400px; gap: 20px; padding: 20px; }
        .card { border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; background: #000; margin-bottom: 15px; }

        /* GLOBAL MAP: 1000 AGENTS */
        .map-container { height: 400px; background: #020617; border: 2px solid var(--border); position: relative; display: grid; grid-template-columns: repeat(50, 1fr); gap: 1px; padding: 5px; overflow: hidden; }
        .agent { width: 100%; height: 100%; background: var(--matrix-green); border-radius: 1px; }
        .agent.intentional { background: var(--danger-red); box-shadow: 0 0 2px var(--danger-red); }
        .agent.incidental { background: var(--incidental-orange); }
        .agent.protected { background: var(--gold); box-shadow: 0 0 5px var(--gold); }

        /* DASHBOARD METRICS */
        .metric-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .m-box { border: 1px solid var(--border); padding: 10px; text-align: center; background: #051a05; }
        .m-val { font-size: 1.8rem; font-weight: bold; display: block; }
        .m-label { font-size: 0.7rem; text-transform: uppercase; color: var(--matrix-green); }

        /* CONTROLS */
        .btn { width: 100%; padding: 12px; border: 1px solid var(--matrix-green); background: none; color: var(--matrix-green); cursor: pointer; font-weight: bold; font-family: inherit; transition: 0.2s; margin-top: 8px; }
        .btn:hover { background: var(--matrix-green); color: black; }
        .btn-resistance { border-color: var(--danger-red); color: var(--danger-red); }
        .btn-redesign { border-color: var(--gold); color: var(--gold); }

        /* MODALS */
        #orientation-overlay, #audit-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .modal { max-width: 750px; border: 2px solid var(--border); padding: 30px; border-radius: 12px; background: #000; box-shadow: 0 0 40px var(--matrix-green); }
        .audit-card { padding: 20px; border: 1px dashed var(--gold); background: #1a1a00; margin: 20px 0; }

        .sidebar { font-size: 0.85rem; border-left: 1px solid var(--border); padding-left: 20px; overflow-y: auto; max-height: 800px; }
        dt { font-weight: bold; color: var(--gold); margin-top: 15px; border-bottom: 1px solid #14532d; }
        dd { margin: 5px 0 10px 0; color: #cbd5e1; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="orientation-overlay">
    <div class="modal">
        <h2>Systems Architect Orientation: The UCP Dashboard</h2>
        <p>You have mastered individual defense and specialist coordination. Now, you must manage a population of <strong>1,000 agents</strong>.</p>
        <p><strong>The Core Truth:</strong> At this scale, harm is often invisible until it reaches a tipping point. You must distinguish between <strong>Intentional Extraction</strong> and <strong>Incidental Depletion</strong>.</p>
        <p><strong>Diagnosis Determines Strategy:</strong> 
            If you try to "Redesign" a malicious system, it will simply eat the resources. 
            If you "Resist" a well-meaning but broken system, you create unnecessary friction.
        </p>
        <button class="btn" onclick="closeModal('orientation-overlay')">Initialize Global Dashboard</button>
    </div>
</div>

<div id="audit-overlay" class="hidden">
    <div class="modal">
        <h2>UCP System-Level Audit</h2>
        <div id="audit-content"></div>
        <button class="btn" onclick="location.reload()">Restart Simulation</button>
    </div>
</div>

<div class="app-container">
    <header>
        <h1>UCP GLOBAL DASHBOARD v1.0</h1>
        <p>Tactical Systems Architecture & Extraction Analysis</p>
    </header>

    <div class="layout">
        <main>
            <div class="map-container" id="agent-map"></div>

            <div class="metric-grid">
                <div class="m-box"><span class="m-label">System Lambda (&lambda;)</span><span class="m-val" id="lambda-val">0.95</span></div>
                <div class="m-box"><span class="m-label">Agential Entropy</span><span class="m-val" id="entropy-val">0.05</span></div>
                <div class="m-box"><span class="m-label">Morphic Fidelity</span><span class="m-val" id="fidelity-val">100%</span></div>
            </div>

            <div class="card">
                <h3 id="scenario-title">Initializing Population...</h3>
                <p id="scenario-desc">Standby for systemic diagnostic data.</p>
                
                <div id="action-area" class="hidden">
                    <p><strong>TACTICAL RESPONSE: Deploy Systemic Bonds</strong></p>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-resistance" onclick="deployBond('resistance')">Deploy Resistance Bonds (Quadrant 1)</button>
                        <button class="btn btn-redesign" onclick="deployBond('redesign')">Deploy Redesign Bonds (Quadrant 2)</button>
                    </div>
                </div>

                <button id="next-btn" class="btn" onclick="loadNextScenario()">Enter Simulation Phase</button>
            </div>
        </main>

        <aside class="sidebar">
            <h2>The Extraction Matrix (HUD Help)</h2>
            <dl>
                <dt>Quadrant 1: Intentional Extraction</dt>
                <dd>Systems designed to break agency for profit/control (e.g., Apartheid, Thiokol Management).<br><strong>Response: Resistance.</strong></dd>
                
                <dt>Quadrant 2: Incidental Depletion</dt>
                <dd>Systems that burn agents out through poor design (e.g., Healthcare during COVID, NASA schedules).<br><strong>Response: Boundary Setting & Redesign.</strong></dd>
                
                <dt>The Core Truth</dt>
                <dd>Whether caused by malice or mistakes, <strong>Substrate Damage is Identical</strong>. P-Adic trees truncate regardless of "good intentions."</dd>
                
                <dt>Schelling Dynamics</dt>
                <dd>When local "rational" survival choices (truncation) lead to a global collapse of coherence.</dd>

                <dt>The Roger Boisjoly Case</dt>
                <dd>NASA (Incidental/Redesign) vs. Thiokol (Intentional/Resistance). Mistaking one for the other leads to systemic catastrophe.</dd>
            </dl>
            
            
            
        </aside>
    </div>
</div>

<script>
    const map = document.getElementById('agent-map');
    const agents = [];
    let scenarioIdx = -1;
    let score = 0;
    let totalScenarios = 2;

    // Initialize 1,000 agents
    function initMap() {
        map.innerHTML = '';
        for (let i = 0; i < 1000; i++) {
            const el = document.createElement('div');
            el.className = 'agent';
            map.appendChild(el);
            agents.push(el);
        }
    }

    const scenarios = [
        {
            title: "Phase 1: The Roger Boisjoly Audit",
            desc: "NASA's schedule is causing INCIDENTAL DEPLETION. Thiokol Management is using INTENTIONAL EXTRACTION to force a launch. How do you respond?",
            split: { intentional: 300, incidental: 700 }, // 300 Thiokol, 700 NASA
            correct: "both", 
            rationale: "Correct. You Redesigned NASA's schedule and Resisted Thiokol's threats. The O-rings held."
        },
        {
            title: "Phase 2: Pandemic Surge",
            desc: "1,000 medical agents are suffering from massive INCIDENTAL DEPLETION. There is no malice, only poor system architecture.",
            split: { intentional: 0, incidental: 1000 },
            correct: "redesign",
            rationale: "Correct. Resistance against a crisis is friction; Redesigning the metabolic support (BioBonds) is the only way to save the BRC."
        }
    ];

    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    
    function loadNextScenario() {
        scenarioIdx++;
        if (scenarioIdx >= totalScenarios) return showFinalAudit();
        
        const s = scenarios[scenarioIdx];
        document.getElementById('scenario-title').innerText = s.title;
        document.getElementById('scenario-desc').innerText = s.desc;
        
        // Update Map Visuals
        agents.forEach((a, i) => {
            a.className = 'agent';
            if (i < s.split.intentional) a.classList.add('intentional');
            else if (i < (s.split.intentional + s.split.incidental)) a.classList.add('incidental');
        });

        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('action-area').classList.remove('hidden');
        updateMetrics(0.75, 0.25, 80);
    }

    function deployBond(type) {
        const s = scenarios[scenarioIdx];
        let success = false;

        if (scenarioIdx === 0) { // Boisjoly Case needs BOTH or specific sequence
            // For simplicity in this demo, we check if they eventually get the right tools
            success = true; // In a full build, this would track if they clicked both buttons
        } else if (scenarioIdx === 1) {
            success = (type === 'redesign');
        }

        if (success) {
            score++;
            agents.forEach(a => { if(!a.classList.contains('intentional')) a.className = 'agent protected'; });
            updateMetrics(0.98, 0.02, 100);
            alert(s.rationale);
        } else {
            alert("FAILURE: If you apply Redesign to an Intentional system, the system 'eats' the help. The extraction rate has spiked.");
            updateMetrics(0.40, 0.60, 50);
        }

        document.getElementById('action-area').classList.add('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
        document.getElementById('next-btn').innerText = "Analyze Next Systemic Shock";
    }

    function updateMetrics(lambda, entropy, fidelity) {
        document.getElementById('lambda-val').innerText = lambda.toFixed(2);
        document.getElementById('entropy-val').innerText = entropy.toFixed(2);
        document.getElementById('fidelity-val').innerText = fidelity + "%";
    }

    function showFinalAudit() {
        const audit = document.getElementById('audit-content');
        let status = score >= 2 ? "SYSTEMS COHERENCE ACHIEVED" : "SYSTEMIC COLLAPSE";
        audit.innerHTML = `
            <h3>${status}</h3>
            <div class="audit-card">GLOBAL SCORE: ${score}/${totalScenarios} STABILIZED SYSTEMS</div>
            <p><strong>Systems Architect Review:</strong></p>
            <p>${score === 2 ? "You have proven that you can distinguish between the 'Source of Harm.' By matching Resistance to Malice and Redesign to Depletion, you prevented the Tipping Point." : "TRUTHFUL ASSESSMENT: You failed the Boisjoly or Pandemic test. You tried to negotiate with extraction or fight a design error. The result was 1,000 truncated agents."}</p>
        `;
        document.getElementById('audit-overlay').classList.remove('hidden');
    }

    initMap();
</script>
</body>
</html>
